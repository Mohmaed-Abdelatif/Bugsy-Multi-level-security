<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <script>
        // Set your API base URL (adjust if needed)
    const API = 'http://localhost/Bugsy/api/v1';

// Test 2: Register (creates account + session)
fetch(`${API}/login`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    credentials: 'include', // ← CRITICAL!
    body: JSON.stringify({
        email: 'browser2@test.com',
        password: 'pass123'
    })
})
.then(r => r.json())
.then(data => {
    console.log('✅ Test 2 - Register:', data);
    console.log('Session ID:', data.data?.session_id);
})
.catch(err => console.error('❌ Test 2 Failed:', err));


// // Test 3: Check if session persists
// fetch(`${API}/test/session`, {
//     credentials: 'include'
// })
// .then(r => r.json())
// .then(data => {
//     console.log('✅ Test 3 - Session:', data);
//     console.log('Logged in:', data.data?.logged_in);
// })
// .catch(err => console.error('❌ Test 3 Failed:', err));



// // Test 4: Access protected endpoint (requires auth)
fetch(`${API}/test/protected`, {
    credentials: 'include'
})
.then(r => r.json())
.then(data => {
    console.log('✅ Test 4 - Protected:', data);
    console.log('User:', data.data?.user);
})
.catch(err => console.error('❌ Test 4 Failed:', err));

// Test 5: Logout
// fetch(`${API}/logout`, {
//     method: 'POST',
//     credentials: 'include'
// })
// .then(r => r.json())
// .then(data => {
//     console.log('✅ Test 5 - Logout:', data);
// })
// .catch(err => console.error('❌ Test 5 Failed:', err));

// Test 6: Try protected endpoint after logout (should fail)
// fetch(`${API}/test/protected`, {
//     credentials: 'include'
// })
// .then(r => r.json())
// .then(data => {
//     if (data.success === false) {
//         console.log('✅ Test 6 - Correctly blocked:', data.message);
//     } else {
//         console.error('❌ Test 6 - Should have been blocked!');
//     }
// })
// .catch(err => console.error('❌ Test 6 Failed:', err));

</script>
</body>
</html>